<patTemplate:tmpl name="pageoutput" unusedvars="strip">
<script type="text/javascript">
function toggle_review_div(uid)
	{
	div_id = "#property_reviews"+uid;
	div_click_link = '#property_reviews_link'+uid;
	jomresJquery( div_id ).dialog({
		width: 800,
		height: 500,
		show: 'slide',
		modal: true
		});
	};
	
var killScroll = false; // IMPORTANT
function lastAddedLiveFunc() 
	{
	jomresJquery.get("{JOMRES_SITEPAGE_URL_AJAX}&task=ajax_list_properties&nofollowtmpl&lastID="+jomresJquery(".jomres_property_list_propertywrapper:last").attr("id"),
	//alert (jomresJquery(".jomres_property_list_propertywrapper:last").attr("id"));
		function(data){
			if (data != "") {
			jomresJquery(".jomres_property_list_propertywrapper:last").after(data);
			
			}
		killScroll = false; // IMPORTANT - Make function available again.
		});
	
	};  
	
	jomresJquery(window).scroll(function(){
		if (jomresJquery(window).height() + jomresJquery(window).scrollTop() >= jomresJquery(document).height()-300) {
		if (killScroll == false) { // IMPORTANT - Keeps the loader from fetching more than once.
			killScroll = true; // IMPORTANT - Set killScroll to true, to make sure we do not trigger this code again before it's done running.
			lastAddedLiveFunc();
			}
		}
	});

function runEffect(uid) {
	var selectedEffect = "blind";
	var options = {};
	if ( selectedEffect === "scale" ) {
		options = { percent: 0 };
	} else if ( selectedEffect === "size" ) {
		options = { to: { width: 200, height: 60 } };
	}
	jomresJquery( "#effect"+uid ).toggle( selectedEffect, options, 500 );
	return false;
};
</script>
<patTemplate:tmpl name="nav_output_top" type="simpleCondition" requiredVars="writepagescounter">
<div>
	{WRITEPAGESCOUNTER}
</div>
<div>
	{WRITEPAGESLINKS}
</div>
</patTemplate:tmpl>
<patTemplate:tmpl name="property_details" unusedvars="strip">
<table width="100%" class="ui-widget-content ui-corner-all jomres_property_list_propertywrapper" id="{UID}" border="0">
    <tr class="ui-widget-header">
    	<td colspan="2" width="100%" class="property-header">
        	{PROPERTY_TYPE}
            <span class="float-right">{PRICESFROM}&nbsp;<strong>{LOWESTPRICE}</strong></span>
        </td>
    </tr>
    <tr>
       <td align="left" width="200">
            <a href="{MOREINFORMATIONLINK}">{IMAGE_POPUP}</a>
       </td>
       <td valign="top" align="left" width="100%">
       		<table width="100%" border="0">
            	<tr>
                	<td colspan="2">
                    	<div class="property-title"><a href="{MOREINFORMATIONLINK}"><strong>{PROPERTYNAME}</strong></a>&nbsp;{STARS}</div>
                    </td>
                </tr>
                <tr>
                	<td width="100%" valign="top">
                		<div><em>{PROP_TOWN}, {PROP_REGION}, {PROP_COUNTRY}</em></div>
                		<div class="property-desc">{PROPERTYDESC}</div>
                    	<div class="jomres_message">{LASTMINUTE}</div>
                    </td>
                    <td align="right" rowspan="3">
                        <div class="fg-toolbar fg-buttonset">
                            <a href="{LINK}" class="fg-button ui-state-default ui-corner-all plist-button">{BOOKTHIS_TEXT}</a>
                            <a href="{MOREINFORMATIONLINK}" class="fg-button ui-state-default ui-corner-all plist-button">{MOREINFORMATION}</a>
                            <a href="javascript:void(0);" onClick="toggle_review_div({UID});" class="fg-button ui-state-default ui-corner-all plist-button"><div id="property_reviews_link{UID}">{_JOMRES_REVIEWS_CLICKTOSHOW}</div></a>
                            <div><a href="javascript:void(0);" onClick="runEffect({UID});" class="fg-button ui-state-default ui-corner-all plist-button-last">{_JOMRES_QUICK_INFO}</a></div>
                        </div>
      				</td>
                </tr>
         	</table>
        </td>
    </tr>
    <tr>
    	<td colspan="2">
        	<div id="effect{UID}" class="quick-info">
                <div class="ui-widget-content ui-corner-all quick-info-left float-left">
                    <div><strong>Room Type/s</strong></div>
                    <div>{ROOMTYPES}</div>
                    <div style="clear:both;"></div>
                    <div><strong>Facilities</strong></div>
                    <div>{FEATURELIST}</div>
                    <div style="clear:both;"></div>
                 </div>
                 <div class="ui-widget-content ui-corner-all quick-info-right float-right">
                   <!-- <div><strong>Sleeps:</strong> W</div>
                    <div><strong>Bedrooms:</strong> X</div>
                    <div><strong>Bathrooms:</strong> Y</div>
                    <div><strong>Square meters:</strong> Z</div>-->
                    <div>&nbsp;</div>
                    <!--<div><strong>{_JOMRES_REVIEWS}</strong></div>-->
                    <div><strong>{_JOMRES_REVIEWS_AVERAGE_RATING}</strong>{AVERAGE_RATING}</div>
                    <div><strong>{_JOMRES_REVIEWS_TOTAL_VOTES}</strong> {NUMBER_OF_REVIEWS}</div>
                    <div>&nbsp;</div>
                    <div class="{LASTBOOKING_STYLE}">{LASTBOOKED}</div>
                </div>
            </div>
        </td>
    </tr>
</table>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable ui-resizable" id="property_reviews{UID}" style="display: none;">
	{REVIEWS}
</div>
</patTemplate:tmpl>
<patTemplate:tmpl name="nav_output_bottom" type="simpleCondition" requiredVars="writepagescounter">
<div>
	{WRITEPAGESCOUNTER}
</div>
<div>
	{WRITEPAGESLINKS}
</div>
</patTemplate:tmpl>
</patTemplate:tmpl>