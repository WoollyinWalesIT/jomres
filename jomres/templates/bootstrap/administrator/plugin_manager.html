<patTemplate:tmpl name="pageoutput" unusedvars="strip">
	<script type="text/javascript">
		<!--
		var plugins_to_upgrade = '{PLUGINS_TO_UPGRADE}';
		var ajax_url = '{JOMRES_SITEPAGE_URL_ADMIN_AJAX}';
		
		function upgrade_core_plugins(){
			jomresJquery.blockUI({ 
			message: '<h3>Upgrading plugins, please wait, this may take a few minutes depending on internet speed.</h3><br/> The page will reload when the plugins have been updated, but it is important that you do not interrupt the process.',
			baseZ: 1030,
			css: { 
				border: 'none', 
				padding: '15px', 
				backgroundColor: '#000', 
				'-webkit-border-radius': '10px', 
				'-moz-border-radius': '10px', 
				opacity: .5, 
				color: '#fff' 
			} });
			
			
			if (plugins_to_upgrade.length ){
				setTimeout(function(){
					plugins = plugins_to_upgrade.split(",");
					for (var i = 0, l = plugins.length; i < l; i++) {
						plugin = plugins[i];
						if (plugin != '') {
							jomresJquery.ajax({ url: '{JOMRES_SITEPAGE_URL_ADMIN_AJAX}&task=addplugin&plugin=' + plugin + '&autoupgrade=1', success: function (data) {
								//console.log(data);
							}, async: false
							});
						}
						 if ( i ==plugins.length-1)
				  			window.location.reload();
					}
				},3000);
			}
			else 
	 			jomresJquery.unblockUI();

	 		return false;
		}

		//-->
	</script>

	{LICENSE_WARNING}
	<h2 class="page-header">{PAGETITLE}</h2>
	<style>
	.modal-body {
		max-height: 800px;
		}
	</style>

	<div class="row-fluid">
		<div class="span9">
		<patTemplate:tmpl name="developer_users" type="simpleCondition" requiredVars="dummy">
			<p class="alert alert-warning">Please do not install all plugins with the hope that they will come in
				useful later. They are not all mutually exclusive, I.E. one plug may interfere with another, so it
				is recommended that you only install a plugin when you\'ve identified a requirement that the
				individual plugin fulfills. <br/>Bold items in the core plugins list are generally essential when
				building a portal, and if you have upgraded from v4 you should consider installing those plugins to
				continue working as before.</p>
		</patTemplate:tmpl>
		
		<patTemplate:tmpl name="bronze_users" type="simpleCondition" requiredVars="license_server_username">
		<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#shopping_cart">
			Show cart
		</button>

		<div id="license_server_account_details" class="modal hide fade " tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h3 id="cart_label">Your cart</h3>
				</div>
				<div class="modal-body">
					<div id="username_input" >
						
						<p class="small">Before you can purchase plugins, you need a Username and Password, which you can get by registering for free at <a href="https://license-server.jomres.net/index.php?cmd=register" target="_blank">Jomres.net</a>.<br/> If you already have a username and password please enter them here. When you've done that, click the Purchase Plugins! button.</p>
						
						<form class="form-inline">
							<fieldset>
								<div class="control-group">
									<label class="control-label" for="name">License server Username</label>
									<div class="controls">
										<input class="input-medium" type="text" id="license_server_username" name="name" value="{LICENSE_SERVER_USERNAME}" placeholder="Your username" required autofocus/>
									</div>
								</div>

								<div class="control-group">
									<label class="control-label" for="country_name">License server Password</label>
									<div class="controls">
										<input class="input-large" type="password" id="license_server_password" name="password" value="{LICENSE_SERVER_PASSWORD}" required/>
									</div>
								</div>
							</fieldset>
						</form>
						<p class="small">Once you have paid your invoice, Jomres will automatically offer you an installation link next to your purchased plugin(s), click that link to install the plugin(s).</p><br />
						<p class="small">Note that purchase of a plugin download does not entitle you to support for Jomres, only for the purchased plugin.</p><br />
						
					</div>
				</div>
				<div class="modal-footer">
				<button class="btn btn-primary" id="purchase_button" onClick="sumbint();">Purchase plugins!</button>
				</div>
			</div>
		</div>
		

		<div id="shopping_cart" class="modal hide fade " tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h3 id="cart_label">Your cart</h3>
				</div>
				<div class="modal-body">
					<div id="cart_wrapper">
						<div class="row-fluid">
							<div class="span9">
								<h3>Total &pound;<span id="total"></span></h3>
							</div>
							<div class="span3">
								<h3 class="page-header"><img src = "{LIVE_SITE}/jomres/images/cart_red_transparent.png"/>Your shopping cart</h3>
							</div>
						</div>

						<div id="cart" class="well"></div>
						
						<p class="alert alert-info">Prices do not include VAT. If you are liable to pay VAT this will show on your invoice once you have placed your order.</p>
						<p class="alert alert-warning">Note, if you have a Jomres Starter, Business or Enterprise license number you don't need to fill these fields, instead please make sure you've entered it in the <i>Site Configuration -> Misc tab -> Support key</i> field, otherwise you will not be able to download plugins that you are entitled to.</p>
					</div>
				</div>
				<div class="modal-footer">
					<button id="purchase" class="btn btn-primary" onClick="purchase();">Order plugin(s)</button>
				</div>
			</div>
		</div>
		
		<div id="hidden_inputs"  class="hide"></div>
		</patTemplate:tmpl>
		

	
		</div>
		<div class="span3">
			<h3 class="page-header">Legend</h3>
			<table width="100%" class="">
				<tr class="alert alert-success">
					<td align="center">Already installed</td>
				</tr>
				<tr class="alert alert-warning">
					<td align="center">Upgrade is available</td>
				</tr>
				<tr class="alert alert-danger">
					<td align="center">Plugin retired, uninstall it</td>
				</tr>
				<!--<tr class="alert alert-info">
					<td align="center">Free plugin</td>
				</tr>
				<tr class="alert">
					<td align="center">Third party plugin</td>
				</tr>-->
			</table>
		</div>
	</div>
	<h3 class="page-header">Plugins</h3>

	<div class="tabbable">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#coreplugins" data-toggle="tab">Jomres.net plugins</a></li>
			<li><a href="#3rdpplugins" data-toggle="tab">Third party plugins</a></li>
			<li><a href="#install3rdpplugin" data-toggle="tab">Install third party plugin</a></li>
		</ul>
		<div class="tab-content">
			<div class="tab-pane active" id="coreplugins">
				<patTemplate:tmpl name="plugins_require_upgrade" type="simpleCondition" requiredVars="upgrade_text">
					<a href="javascript:void(0);" onclick="upgrade_core_plugins();" id="upgrade_core_plugins" class="btn btn-primary btn-large">{UPGRADE_TEXT}</a>
				</patTemplate:tmpl>
				<table width="100%" class="table">
					<tr>
						<th>Name</th>
						<th></th>
						<th>Add/reinstall/upgrade plugin</th>
						<th>Remove plugin</th>
						<th>{HPLUGINPRICE}</th>
					</tr>
					<patTemplate:tmpl name="jomresdotnet_plugins" unusedvars="strip">
					<tr>
						<td class="{ROWCLASS}"><a name="{PLUGIN_NAME}"></a>{STRONG1}{READABLE_NAME}{STRONG2}</td>
						<!--<td><a href="#" class="thumbnail"><img src="{IMAGE}" alt=""></a></td>-->
						<td>
							<button type="button" class="btn btn-info" data-toggle="modal" data-target="#modal_trigger_{PLUGIN_NAME}">More info</button>
						</td>
						<td>{INSTALL} {LATERVERSION}</td>
						<td>{UNINSTALL}</td>
						<td>{ADD_TO_CART_BUTTON}</td>
					</tr>
					<!-- Modal -->
					<div id="modal_trigger_{PLUGIN_NAME}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
							<h3 id="myModalLabel">{READABLE_NAME}</h3>
						</div>
						<div class="modal-body">
							<div class="row-fluid">
								<div class="span6">
									<img src="{IMAGE}" class="img-responsive" alt="{READABLE_NAME}"/>
								</div>
								<div class="span6">
									<div class="alert alert-info">
										<p>Minimum Jomres version {MIN_JOMRES_VER}</p>
										<p>Your Version {LOCAL_VER}</p>
										<p>Current Version {REMOTE_VER}</p>
										<p>Last updated {LASTUPDATE}</p>
										<p>
											<a href="{MANUAL_LINK}" target="_blank" class="{MANUAL_CLASS}">{MANUAL_TEXT}</a>
											<a href="{DEMO_LINK}" target="_blank" class="{DEMO_CLASS}">{DEMO_TEXT}</a>
										</p>
									</div>
								</div>
							</div>
							<p>{PLUGIN_DESC}</p>
							<p class="{HIGHLIGHT_CLASS}">{HIGHLIGHT}</p>
							<button type="button" class="btn" data-toggle="collapse" data-target="#collapse_{PLUGIN_NAME}">
								Changelog
							</button>
							<div id="collapse_{PLUGIN_NAME}" class="collapse">
								<div class="row-fluid">
									<div class="span12">
										<p class="muted">{CHANGELOG}</p>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</div>
					</div>
					</patTemplate:tmpl>
				</table>
			</div>
			<div class="tab-pane" id="3rdpplugins">
				<table width="100%" class="table table-striped">
					<thead>
					<tr>
						<th colspan="6"></th>
					</tr>
					</thead>
					<tbody>
					<tr>
						<th>Name</th>
						<th>Your Version</th>
						<th>Description</th>
						<th>Author</th>
						<th>Author email</th>
						<th>Remove plugin</th>
					</tr>
					<patTemplate:tmpl name="thirdpartyplugins" unusedvars="nbsp" type="simpleCondition" requiredVars="name">
						<tr>
							<td>{NAME}</td>
							<td>{LOCALVERSION}</td>
							<td>{DESCRIPTION}</td>
							<td>{AUTHOR}</td>
							<td><a href="mailto:{AUTHOREMAIL}?subject={NAME}">{AUTHOREMAIL}</a></td>
							<td><a href="{UNINSTALLLINK}" class="btn btn-danger">{UNINSTALL}</a></td>
						</tr>
					</patTemplate:tmpl>
					</tbody>
				</table>
			</div>
			<div class="tab-pane" id="install3rdpplugin">
				<form enctype="multipart/form-data" action="{JOMRES_SITEPAGE_URL_ADMIN}&task=addplugin&thirdparty=1"
					  method="post" class="form-horizontal">
					<fieldset>
						<div class="control-group">
							<label class="control-label" for="pluginfile">Install third party plugin</label>

							<div class="controls">
								<input type="file" name="pluginfile" class="input-file"/>
							</div>
						</div>
						<div class="form-actions">
							<input type="submit" value="Install" class="btn btn-primary"/>
						</div>
						<input type="hidden" name="no_html" value="1"/>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
</patTemplate:tmpl>